name: '🔎 Check Code Formatting'

on:
  push:
    branches:
      - 'master'
    paths:
      - '**/*.c'
      - '**/*.cc'
      - '**/*.h'

  pull_request:
    types:
      - opened
      - edited
      - reopened
      - synchronize
    branches:
      - 'master'
    paths:
      - '**/*.c'
      - '**/*.cc'
      - '**/*.h'

jobs:
  formatting-check:
    runs-on: ubuntu-24.04
    steps:
    - name: '⏳ Checkout repository'
      uses: actions/checkout@v5
      with:
        submodules: false
        persist-credentials: false

    - name: '🔎 Check code formatting'
      uses: openmv/uncrustify-action@v1
      with:
        config-path: 'tools/uncrustify.cfg'
        extensions: 'c,cc,h'
        exclude-patterns: |
          cubeai/**
          docker/**
          docs/**
          drivers/**
          !drivers/sensors/**
          lib/**
          !lib/imlib/**
          !lib/tflm/**
          scripts/**
          tools/**
        uncrustify-version: '0.75.0'
        fail-on-error: true
